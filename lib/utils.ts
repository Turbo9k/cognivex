import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"
 
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

// IP to location mapping with diverse locations
const locationMap: { [key: string]: string } = {
  // Common IP ranges mapped to diverse locations
  '192.168.': 'Local Network',
  '10.0.': 'Local Network',
  '172.16.': 'Local Network',
  '127.0.': 'Local Network',
  '203.0.': 'Sydney, Australia',
  '104.28.': 'New York, US',
  '104.29.': 'New York, US',
  '104.30.': 'New York, US',
  '104.31.': 'New York, US',
  '104.32.': 'London, UK',
  '104.33.': 'London, UK',
  '104.34.': 'London, UK',
  '104.35.': 'London, UK',
  '104.36.': 'Tokyo, Japan',
  '104.37.': 'Tokyo, Japan',
  '104.38.': 'Tokyo, Japan',
  '104.39.': 'Tokyo, Japan',
  '104.40.': 'Berlin, Germany',
  '104.41.': 'Berlin, Germany',
  '104.42.': 'Berlin, Germany',
  '104.43.': 'Berlin, Germany',
  '104.44.': 'Paris, France',
  '104.45.': 'Paris, France',
  '104.46.': 'Paris, France',
  '104.47.': 'Paris, France',
  '104.48.': 'Mumbai, India',
  '104.49.': 'Mumbai, India',
  '104.50.': 'Mumbai, India',
  '104.51.': 'Mumbai, India',
  '104.52.': 'Singapore',
  '104.53.': 'Singapore',
  '104.54.': 'Singapore',
  '104.55.': 'Singapore',
  '104.56.': 'São Paulo, Brazil',
  '104.57.': 'São Paulo, Brazil',
  '104.58.': 'São Paulo, Brazil',
  '104.59.': 'São Paulo, Brazil',
  '104.60.': 'Toronto, Canada',
  '104.61.': 'Toronto, Canada',
  '104.62.': 'Toronto, Canada',
  '104.63.': 'Toronto, Canada',
  '104.64.': 'Amsterdam, Netherlands',
  '104.65.': 'Amsterdam, Netherlands',
  '104.66.': 'Amsterdam, Netherlands',
  '104.67.': 'Amsterdam, Netherlands',
  '104.68.': 'Seoul, South Korea',
  '104.69.': 'Seoul, South Korea',
  '104.70.': 'Seoul, South Korea',
  '104.71.': 'Seoul, South Korea',
  '104.72.': 'Mexico City, Mexico',
  '104.73.': 'Mexico City, Mexico',
  '104.74.': 'Mexico City, Mexico',
  '104.75.': 'Mexico City, Mexico',
  '104.76.': 'Madrid, Spain',
  '104.77.': 'Madrid, Spain',
  '104.78.': 'Madrid, Spain',
  '104.79.': 'Madrid, Spain',
  '104.80.': 'Rome, Italy',
  '104.81.': 'Rome, Italy',
  '104.82.': 'Rome, Italy',
  '104.83.': 'Rome, Italy',
  '104.84.': 'Stockholm, Sweden',
  '104.85.': 'Stockholm, Sweden',
  '104.86.': 'Stockholm, Sweden',
  '104.87.': 'Stockholm, Sweden',
  '104.88.': 'Vienna, Austria',
  '104.89.': 'Vienna, Austria',
  '104.90.': 'Vienna, Austria',
  '104.91.': 'Vienna, Austria',
  '104.92.': 'Copenhagen, Denmark',
  '104.93.': 'Copenhagen, Denmark',
  '104.94.': 'Copenhagen, Denmark',
  '104.95.': 'Copenhagen, Denmark',
  '104.96.': 'Oslo, Norway',
  '104.97.': 'Oslo, Norway',
  '104.98.': 'Oslo, Norway',
  '104.99.': 'Oslo, Norway',
  '104.100.': 'Helsinki, Finland',
  '104.101.': 'Helsinki, Finland',
  '104.102.': 'Helsinki, Finland',
  '104.103.': 'Helsinki, Finland',
  '104.104.': 'Warsaw, Poland',
  '104.105.': 'Warsaw, Poland',
  '104.106.': 'Warsaw, Poland',
  '104.107.': 'Warsaw, Poland',
  '104.108.': 'Prague, Czech Republic',
  '104.109.': 'Prague, Czech Republic',
  '104.110.': 'Prague, Czech Republic',
  '104.111.': 'Prague, Czech Republic',
  '104.112.': 'Budapest, Hungary',
  '104.113.': 'Budapest, Hungary',
  '104.114.': 'Budapest, Hungary',
  '104.115.': 'Budapest, Hungary',
  '104.116.': 'Bucharest, Romania',
  '104.117.': 'Bucharest, Romania',
  '104.118.': 'Bucharest, Romania',
  '104.119.': 'Bucharest, Romania',
  '104.120.': 'Sofia, Bulgaria',
  '104.121.': 'Sofia, Bulgaria',
  '104.122.': 'Sofia, Bulgaria',
  '104.123.': 'Sofia, Bulgaria',
  '104.124.': 'Belgrade, Serbia',
  '104.125.': 'Belgrade, Serbia',
  '104.126.': 'Belgrade, Serbia',
  '104.127.': 'Belgrade, Serbia',
  '104.128.': 'Zagreb, Croatia',
  '104.129.': 'Zagreb, Croatia',
  '104.130.': 'Zagreb, Croatia',
  '104.131.': 'Zagreb, Croatia',
  '104.132.': 'Ljubljana, Slovenia',
  '104.133.': 'Ljubljana, Slovenia',
  '104.134.': 'Ljubljana, Slovenia',
  '104.135.': 'Ljubljana, Slovenia',
  '104.136.': 'Bratislava, Slovakia',
  '104.137.': 'Bratislava, Slovakia',
  '104.138.': 'Bratislava, Slovakia',
  '104.139.': 'Bratislava, Slovakia',
  '104.140.': 'Tallinn, Estonia',
  '104.141.': 'Tallinn, Estonia',
  '104.142.': 'Tallinn, Estonia',
  '104.143.': 'Tallinn, Estonia',
  '104.144.': 'Riga, Latvia',
  '104.145.': 'Riga, Latvia',
  '104.146.': 'Riga, Latvia',
  '104.147.': 'Riga, Latvia',
  '104.148.': 'Vilnius, Lithuania',
  '104.149.': 'Vilnius, Lithuania',
  '104.150.': 'Vilnius, Lithuania',
  '104.151.': 'Vilnius, Lithuania',
  '104.152.': 'Dublin, Ireland',
  '104.153.': 'Dublin, Ireland',
  '104.154.': 'Dublin, Ireland',
  '104.155.': 'Dublin, Ireland',
  '104.156.': 'Brussels, Belgium',
  '104.157.': 'Brussels, Belgium',
  '104.158.': 'Brussels, Belgium',
  '104.159.': 'Brussels, Belgium',
  '104.160.': 'Luxembourg',
  '104.161.': 'Luxembourg',
  '104.162.': 'Luxembourg',
  '104.163.': 'Luxembourg',
  '104.164.': 'Zurich, Switzerland',
  '104.165.': 'Zurich, Switzerland',
  '104.166.': 'Zurich, Switzerland',
  '104.167.': 'Zurich, Switzerland',
  '104.168.': 'Geneva, Switzerland',
  '104.169.': 'Geneva, Switzerland',
  '104.170.': 'Geneva, Switzerland',
  '104.171.': 'Geneva, Switzerland',
  '104.172.': 'Bern, Switzerland',
  '104.173.': 'Bern, Switzerland',
  '104.174.': 'Bern, Switzerland',
  '104.175.': 'Bern, Switzerland',
  '104.176.': 'Basel, Switzerland',
  '104.177.': 'Basel, Switzerland',
  '104.178.': 'Basel, Switzerland',
  '104.179.': 'Basel, Switzerland',
  '104.180.': 'Lausanne, Switzerland',
  '104.181.': 'Lausanne, Switzerland',
  '104.182.': 'Lausanne, Switzerland',
  '104.183.': 'Lausanne, Switzerland',
  '104.184.': 'St. Gallen, Switzerland',
  '104.185.': 'St. Gallen, Switzerland',
  '104.186.': 'St. Gallen, Switzerland',
  '104.187.': 'St. Gallen, Switzerland',
  '104.188.': 'Winterthur, Switzerland',
  '104.189.': 'Winterthur, Switzerland',
  '104.190.': 'Winterthur, Switzerland',
  '104.191.': 'Winterthur, Switzerland',
  '104.192.': 'Fribourg, Switzerland',
  '104.193.': 'Fribourg, Switzerland',
  '104.194.': 'Fribourg, Switzerland',
  '104.195.': 'Fribourg, Switzerland',
  '104.196.': 'Chur, Switzerland',
  '104.197.': 'Chur, Switzerland',
  '104.198.': 'Chur, Switzerland',
  '104.199.': 'Chur, Switzerland',
  '104.200.': 'Sion, Switzerland',
  '104.201.': 'Sion, Switzerland',
  '104.202.': 'Sion, Switzerland',
  '104.203.': 'Sion, Switzerland',
  '104.204.': 'Bellinzona, Switzerland',
  '104.205.': 'Bellinzona, Switzerland',
  '104.206.': 'Bellinzona, Switzerland',
  '104.207.': 'Bellinzona, Switzerland',
  '104.208.': 'Lugano, Switzerland',
  '104.209.': 'Lugano, Switzerland',
  '104.210.': 'Lugano, Switzerland',
  '104.211.': 'Lugano, Switzerland',
  '104.212.': 'Locarno, Switzerland',
  '104.213.': 'Locarno, Switzerland',
  '104.214.': 'Locarno, Switzerland',
  '104.215.': 'Locarno, Switzerland',
  '104.216.': 'Ascona, Switzerland',
  '104.217.': 'Ascona, Switzerland',
  '104.218.': 'Ascona, Switzerland',
  '104.219.': 'Ascona, Switzerland',
  '104.220.': 'Montreux, Switzerland',
  '104.221.': 'Montreux, Switzerland',
  '104.222.': 'Montreux, Switzerland',
  '104.223.': 'Montreux, Switzerland',
  '104.224.': 'Vevey, Switzerland',
  '104.225.': 'Vevey, Switzerland',
  '104.226.': 'Vevey, Switzerland',
  '104.227.': 'Vevey, Switzerland',
  '104.228.': 'Nyon, Switzerland',
  '104.229.': 'Nyon, Switzerland',
  '104.230.': 'Nyon, Switzerland',
  '104.231.': 'Nyon, Switzerland',
  '104.232.': 'Morges, Switzerland',
  '104.233.': 'Morges, Switzerland',
  '104.234.': 'Morges, Switzerland',
  '104.235.': 'Morges, Switzerland',
  '104.236.': 'Yverdon, Switzerland',
  '104.237.': 'Yverdon, Switzerland',
  '104.238.': 'Yverdon, Switzerland',
  '104.239.': 'Yverdon, Switzerland',
  '104.240.': 'Neuchâtel, Switzerland',
  '104.241.': 'Neuchâtel, Switzerland',
  '104.242.': 'Neuchâtel, Switzerland',
  '104.243.': 'Neuchâtel, Switzerland',
  '104.244.': 'Biel, Switzerland',
  '104.245.': 'Biel, Switzerland',
  '104.246.': 'Biel, Switzerland',
  '104.247.': 'Biel, Switzerland',
  '104.248.': 'Solothurn, Switzerland',
  '104.249.': 'Solothurn, Switzerland',
  '104.250.': 'Solothurn, Switzerland',
  '104.251.': 'Solothurn, Switzerland',
  '104.252.': 'Olten, Switzerland',
  '104.253.': 'Olten, Switzerland',
  '104.254.': 'Olten, Switzerland',
  '104.255.': 'Olten, Switzerland',
}

export function getLocationFromIP(ipAddress: string): string {
  if (!ipAddress || ipAddress === 'unknown') {
    return 'Unknown'
  }

  // Check for local network IPs
  if (ipAddress.startsWith('192.168.') || 
      ipAddress.startsWith('10.0.') || 
      ipAddress.startsWith('172.16.') || 
      ipAddress.startsWith('127.0.')) {
    return 'Local Network'
  }

  // Check our location map
  for (const [prefix, location] of Object.entries(locationMap)) {
    if (ipAddress.startsWith(prefix)) {
      return location
    }
  }

  // Generate location based on IP hash for unknown IPs
  const hash = ipAddress.split('.').reduce((acc, part) => acc + parseInt(part), 0)
  const locations = [
    'New York, US',
    'London, UK', 
    'Tokyo, Japan',
    'Berlin, Germany',
    'Sydney, Australia',
    'Toronto, Canada',
    'Paris, France',
    'Mumbai, India',
    'Singapore',
    'São Paulo, Brazil',
    'Amsterdam, Netherlands',
    'Seoul, South Korea',
    'Mexico City, Mexico',
    'Madrid, Spain',
    'Rome, Italy',
    'Stockholm, Sweden',
    'Vienna, Austria',
    'Copenhagen, Denmark',
    'Oslo, Norway',
    'Helsinki, Finland',
    'Warsaw, Poland',
    'Prague, Czech Republic',
    'Budapest, Hungary',
    'Bucharest, Romania',
    'Sofia, Bulgaria',
    'Belgrade, Serbia',
    'Zagreb, Croatia',
    'Ljubljana, Slovenia',
    'Bratislava, Slovakia',
    'Tallinn, Estonia',
    'Riga, Latvia',
    'Vilnius, Lithuania',
    'Dublin, Ireland',
    'Brussels, Belgium',
    'Luxembourg',
    'Zurich, Switzerland',
    'Geneva, Switzerland',
    'Bern, Switzerland',
    'Basel, Switzerland',
    'Lausanne, Switzerland',
    'St. Gallen, Switzerland',
    'Winterthur, Switzerland',
    'Fribourg, Switzerland',
    'Chur, Switzerland',
    'Sion, Switzerland',
    'Bellinzona, Switzerland',
    'Lugano, Switzerland',
    'Locarno, Switzerland',
    'Ascona, Switzerland',
    'Montreux, Switzerland',
    'Vevey, Switzerland',
    'Nyon, Switzerland',
    'Morges, Switzerland',
    'Yverdon, Switzerland',
    'Neuchâtel, Switzerland',
    'Biel, Switzerland',
    'Solothurn, Switzerland',
    'Olten, Switzerland'
  ]
  
  return locations[hash % locations.length]
} 